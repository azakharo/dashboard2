"use strict";function debounce(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function randomIntFromInterval(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function randomFloatFromInterval(a,b){return Math.random()*(b-a)+a}function getBrowserInfo(){var a,b=navigator.userAgent,c=b.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(c[1])?(a=/\brv[ :]+(\d+)/g.exec(b)||[],{name:"IE ",version:a[1]||""}):"Chrome"===c[1]&&(a=b.match(/\bOPR\/(\d+)/),null!=a)?{name:"Opera",version:a[1]}:(c=c[2]?[c[1],c[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(a=b.match(/version\/(\d+)/i))&&c.splice(1,1,a[1]),{name:c[0],version:c[1]})}angular.module("demoarmApp",["ngCookies","ngResource","ngSanitize","btford.socket-io","ui.router","ui.bootstrap","formly","formlyBootstrap","anguFixedHeaderTable","alertService","restService"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){b.otherwise("/dashboard2/preview"),c.html5Mode(!1),d.interceptors.push("authInterceptor")}]).factory("authInterceptor",["$rootScope","$q","$cookieStore","$location",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),a},responseError:function(a){return 401===a.status?(d.path("/login"),c.remove("token"),b.reject(a)):b.reject(a)}}}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$stateChangeStart",function(a,d){c.isLoggedInAsync(function(a){d.authenticate&&!a&&b.path("/login")})})}]),angular.module("demoarmApp").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/account/login/login.html",controller:"LoginCtrl"}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl"}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0})}]),angular.module("demoarmApp").controller("LoginCtrl",["$scope","Auth","$location","$window",function(a,b,c,d){a.user={},a.errors={},a.login=function(d){a.submitted=!0,d.$valid&&b.login({email:a.user.email,password:a.user.password}).then(function(){c.path("/")})["catch"](function(b){a.errors.other=b.message})},a.loginOauth=function(a){d.location.href="/auth/"+a}}]),angular.module("demoarmApp").controller("SettingsCtrl",["$scope","User","Auth",function(a,b,c){a.errors={},a.changePassword=function(b){a.submitted=!0,b.$valid&&c.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."})["catch"](function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password",a.message=""})}}]),angular.module("demoarmApp").controller("SignupCtrl",["$scope","Auth","$location","$window",function(a,b,c,d){a.user={},a.errors={},a.register=function(d){a.submitted=!0,d.$valid&&b.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){c.path("/")})["catch"](function(b){b=b.data,a.errors={},angular.forEach(b.errors,function(b,c){d[c].$setValidity("mongoose",!1),a.errors[c]=b.message})})},a.loginOauth=function(a){d.location.href="/auth/"+a}}]),angular.module("demoarmApp").controller("AdminCtrl",["$scope","$http","Auth","User",function(a,b,c,d){a.users=d.query(),a["delete"]=function(b){d.remove({id:b._id}),angular.forEach(a.users,function(c,d){c===b&&a.users.splice(d,1)})}}]),angular.module("demoarmApp").config(["$stateProvider",function(a){a.state("admin",{url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminCtrl"})}]);var mod=angular.module("demoarmApp");mod.controller("CardsCtrl",["$scope","$interval","$log","$q","myRest",function(a,b,c,d,e){a.cards=[],e.getCurrencies().then(function(b){e.getCards(b).then(function(b){e.getEvents().then(function(c){e.calcBalance(b,c),e.calcTransactions(b,c),b=_.sortBy(b,function(a){return-a.id}),b=_.sortBy(b,function(a){return a.latestTrans?-a.latestTrans.timestamp:-moment.unix(0)}),a.cards=b})})});var f=b(function(){e.getCurrencies().then(function(b){e.getCards(b).then(function(b){e.getEvents().then(function(c){e.calcBalance(b,c),e.calcTransactions(b,c),b=_.sortBy(b,function(a){return-a.id}),b=_.sortBy(b,function(a){return a.latestTrans?-a.latestTrans.timestamp:-moment.unix(0)});var d=angular.copy(b);if(a.cards.length>0)for(var f=0;f<d.length;f++){var g=d[f],h=e.findCardBySrvID(a.cards,g.srvID);if(h&&!angular.equals(h,g))for(var i=0;i<h.bags.length;i++){var j=h.bags[i],k=e.findCardBag(g,j.srvID);k&&(j.balance!==k.balance?(k.wasUpdated=!0,g.justChanged=!0):k.wasUpdated=!1)}}a.cards=d})})})},5e3);a.$on("$destroy",function(){b.cancel(f)});var g={success:"panel-primary",warning:"panel-warning",danger:"panel-danger"};a.getCardPanelClass=function(a){return g[a]}}]),mod.filter("bagActivePeriodFilter",function(){return function(a){var b="",c="",d="DD.MM.YYYY";return a.activePeriodStart&&(b=a.activePeriodStart.format(d)),a.activePeriodFinish&&(c=a.activePeriodFinish.format(d)),format("{} - {}",b,c)}}),mod.filter("cardTitleFilter",function(){return function(a){var b=format("UID: {}",a.id);return a.isESEK&&(b+=" (ЕСЭК)"),b}}),angular.module("demoarmApp").controller("DashboardCtrl",["$scope",function(a){a.message="Hello"}]),angular.module("demoarmApp").config(["$stateProvider",function(a){a.state("dashboard",{"abstract":!0,url:"/dashboard",templateUrl:"app/dashboard/dashboard.html",controller:"DashboardCtrl"}).state("dashboard.ready",{url:"/preview",views:{cards:{templateUrl:"app/dashboard/cards.html",controller:"CardsCtrl"},turnover:{templateUrl:"app/dashboard/turnover.html",controller:"TurnoverCtrl"},events:{templateUrl:"app/dashboard/events.html",controller:"EventsCtrl"},transactions:{templateUrl:"app/dashboard/transactions.html",controller:"TransactionsCtrl"},flow:{templateUrl:"app/dashboard/flow.html",controller:"FlowCtrl"}}})}]);var mod=angular.module("demoarmApp");mod.controller("EventsCtrl",["$scope","$interval","$log","$q","myRest",function(a,b,c,d,e){function f(){e.getEvents().then(function(b){a.events.forEach(function(a){a.wasUpdated=!1});var c=[];_(b).forEach(function(b){var d=_(a.events).find(function(a){return a.srvTransactionID===b.srvTransactionID});return d?!1:void c.push(b)}),c.length>0&&(_(c).reverse(),c.forEach(function(b){b.wasUpdated=!0,a.events.unshift(b)}))})}var g=null;a.events=[],e.getEvents().then(function(c){a.events=c,g=b(f,5e3)}),a.$on("$destroy",function(){g&&b.cancel(g)})}]),mod.filter("eventOperationFilter",function(){return function(a){var b="неизвестная";return"replenishment"===a?b="пополнение":"payment"===a&&(b="списание"),b}});var mod=angular.module("demoarmApp");mod.controller("FlowCtrl",["$scope","$timeout","$log","myRest",function(a,b,c,d){function e(a){$("#flow-chart").highcharts({chart:{type:"spline",animation:Highcharts.svg,marginRight:10,events:{load:function(){var a=this.series[0];setInterval(function(){d.getTurnover().then(function(b){if(b&&b!==f){var c=(new Date).getTime(),d=b,e=a.data.length>20;a.addPoint([c,d],!0,e),f=b}})},2e3)}}},title:{text:"",style:{fontSize:"30px"}},xAxis:{type:"datetime",tickPixelInterval:150},yAxis:{title:{text:"Кол-во оплативших, чел."},plotLines:[{value:0,width:1,color:"#808080"}],allowDecimals:!1,floor:0},tooltip:{formatter:function(){return"<b>кол-во оплативших: "+Highcharts.numberFormat(this.y,0)+"</b><br/>"+Highcharts.dateFormat("%Y-%m-%d %H:%M:%S",this.x)+"<br/>"}},legend:{enabled:!1},exporting:{enabled:!1},series:[{name:"passengers",data:function(){var b=[];if(a.length>0){var c=_.uniq(a,"timestamp");c.length>20&&(c=c.slice(c.length-20)),_(c).forEach(function(a){b.push({x:a.timestamp.toDate().getTime(),y:a.value})})}else{var d,e=(new Date).getTime();for(d=-19;0>=d;d+=1)b.push({x:e+2e3*d,y:0})}return b}()}]})}var f=-1;Highcharts.setOptions({global:{useUTC:!1}}),d.getTurnoverHistory().then(function(a){f=a.length>0?a[a.length-1].value:0,e(a)})}]),angular.module("demoarmApp").controller("TransactionsCtrl",["$scope",function(a){a.transactions=["transaction 1","transaction 2","transaction 3"]}]);var mod=angular.module("demoarmApp");mod.controller("TurnoverCtrl",["$scope","$timeout","$log","myRest",function(a,b,c,d){function e(a){$("#chart").highcharts({chart:{type:"line",animation:Highcharts.svg,marginRight:10,events:{load:function(){var a=this.series[0];setInterval(function(){d.getTurnover().then(function(b){if(b&&b!==f){var c=(new Date).getTime(),d=b,e=a.data.length>20;a.addPoint([c,d],!0,e),f=b}})},2e3)}}},title:{text:"",style:{fontSize:"30px"}},xAxis:{type:"datetime",tickPixelInterval:150},yAxis:{title:{text:"Кол-во пассажиров, чел."},plotLines:[{value:0,width:1,color:"#808080"}],allowDecimals:!1,floor:0},tooltip:{formatter:function(){return"<b>кол-во пассажиров: "+Highcharts.numberFormat(this.y,0)+"</b><br/>"+Highcharts.dateFormat("%Y-%m-%d %H:%M:%S",this.x)+"<br/>"}},legend:{enabled:!1},exporting:{enabled:!1},series:[{name:"passengers",data:function(){var b=[];if(a.length>0){var c=_.uniq(a,"timestamp");c.length>20&&(c=c.slice(c.length-20)),_(c).forEach(function(a){b.push({x:a.timestamp.toDate().getTime(),y:a.value})})}else{var d,e=(new Date).getTime();for(d=-19;0>=d;d+=1)b.push({x:e+2e3*d,y:0})}return b}(),step:!0}]})}var f=-1;Highcharts.setOptions({global:{useUTC:!1}}),d.getTurnoverHistory().then(function(a){f=a.length>0?a[a.length-1].value:0,e(a)})}]);var mod=angular.module("demoarmApp");mod.controller("BusesCtrl",["$scope","$interval","$log","$q","myRest",function(a,b,c,d,e){function f(){e.getPassengersInOut().then(function(b){angular.equals(b,h)||(h=angular.copy(b),a.noData=0===b.length,a.data=b)})}a.noData=!0,f();var g=b(function(){f()},5e3);a.$on("$destroy",function(){b.cancel(g)});var h=void 0}]),mod.filter("busInputFilter",function(){return function(a){return a?format("+{}",a):""}}),mod.filter("busOutputFilter",function(){return function(a){return a?format("-{}",a):""}});var mod=angular.module("demoarmApp");mod.controller("CardProcCtrl",["$scope","$interval","$log","$q","myRest",function(a,b,c,d,e){a.cards=[],e.getCurrencies().then(function(b){e.getCards(b).then(function(b){e.getEvents().then(function(c){e.calcBalance(b,c),e.calcTransactions(b,c),b=_.sortBy(b,function(a){return-a.id}),b=_.sortBy(b,function(a){return a.latestTrans?-a.latestTrans.timestamp:-moment.unix(0)}),a.cards=b})})});var f=b(function(){e.getCurrencies().then(function(b){e.getCards(b).then(function(b){e.getEvents().then(function(c){e.calcBalance(b,c),e.calcTransactions(b,c),b=_.sortBy(b,function(a){return-a.id}),b=_.sortBy(b,function(a){return a.latestTrans?-a.latestTrans.timestamp:-moment.unix(0)});var d=angular.copy(b);if(a.cards.length>0)for(var f=0;f<d.length;f++){var g=d[f],h=e.findCardBySrvID(a.cards,g.srvID);if(h&&!angular.equals(h,g))for(var i=0;i<h.bags.length;i++){var j=h.bags[i],k=e.findCardBag(g,j.srvID);k&&(j.balance!==k.balance?(k.wasUpdated=!0,g.justChanged=!0):k.wasUpdated=!1)}}a.cards=d})})})},5e3);a.$on("$destroy",function(){b.cancel(f)});var g={success:"panel-primary",warning:"panel-warning",danger:"panel-danger"};a.getCardPanelClass=function(a){return g[a]}}]),mod.filter("bagActivePeriodFilter",function(){return function(a){var b="",c="",d="DD.MM.YYYY";return a.activePeriodStart&&0!==a.activePeriodStart.unix()||a.activePeriodFinish&&0!==a.activePeriodFinish.unix()?(b=a.activePeriodStart&&0!==a.activePeriodStart.unix()?a.activePeriodStart.format(d):null,c=a.activePeriodFinish&&0!==a.activePeriodFinish.unix()?a.activePeriodFinish.format(d):null,b?c?format("с {} до {}",b,c):format("с {}",b):format("до {}",c)):"нет"}}),mod.filter("cardTitleFilter",function(){return function(a){var b=format("Карта {}",a.id);return a.isESEK&&(b+=" (ЕСЭК)"),b}});var mod=angular.module("demoarmApp");mod.controller("Dashboard2Ctrl",["$scope","$state","$log","$anchorScroll","$location","$rootScope","myRest",function(a,b,c,d,e,f,g){function h(a){e.hash()!==a?e.hash(a):d()}function i(a,b){var c=$(a),d=c.width(),e=(c.height(),c.highcharts());e&&e.setSize(d,b,!1)}function j(a,b,c){var d=$(a),e=(d.width(),d.height(),d.highcharts());e&&e.setSize(c,b,!1)}a.baseURL=g.getBaseURL(),f.busInfoTableH=340;var k=debounce(function(){b.reload()},1e3);$(window).resize(k),a.gotoPage1=function(){h("wrapper")},a.gotoPage2=function(){h("page2")},a.resizePartsPage1=debounce(function(){var a=$("#page1").height(),b=$("#header").height(),c=$("#page1-content").height(),d=Math.floor(c/2),e=d-$("#pies-header").height()-5-10,f=getBrowserInfo();if("Firefox"!==f.name)i("#privileges-chart",e),i("#cards-chart",e),i("#trans-chart",e-10);else{var g=$("#page1").width();d=Math.floor((a-b)/2-20),e=d-$("#pies-header").height()-5-10;var h=Math.floor(g/2-20),k=Math.floor(g/4-10);j("#privileges-chart",e,k),j("#cards-chart",e,k),j("#trans-chart",e-10,h),$("#left-part").height(Math.floor(a-b))}},500),a.resizePartsPage2=debounce(function(){var a=$("#page2").height(),b=$("#page2-navi").height(),c=($("#page2-line1").height(),$("#page2-line2").height(),$("#footer").height()),d=(a-b-c)/2;i("#pass-flow-chart",d),i("#pass-flow-hours-chart",d),i("#pass-km-chart",d-20);var e=$("#bus-infos-table-hdr"),g=($("#bus-infos-table-body"),$("#buses-page-title")),h=Math.floor(d-g.height()-20-e.height()-20)-30;f.busInfoTableH=h,f.$digest()},500)}]),angular.module("demoarmApp").config(["$stateProvider",function(a){a.state("dashboard2",{"abstract":!0,url:"/dashboard2",templateUrl:"app/dashboard2/dashboard2.html",controller:"Dashboard2Ctrl"}).state("dashboard2.ready",{url:"/preview",views:{cardproc:{templateUrl:"app/dashboard2/cardproc.html",controller:"CardProcCtrl"},pies:{templateUrl:"app/dashboard2/pies.html",controller:"PiesCtrl"},transactions:{templateUrl:"app/dashboard2/transactions.html",controller:"TransactionsCtrl"},passFlow:{templateUrl:"app/dashboard2/passFlow.html",controller:"PassFlowCtrl"},passFlowHours:{templateUrl:"app/dashboard2/passFlowHours.html",controller:"PassFlowHoursCtrl"},passKm:{templateUrl:"app/dashboard2/passKm.html",controller:"PassKmCtrl"},buses:{templateUrl:"app/dashboard2/buses.html",controller:"BusesCtrl"}}})}]);var mod=angular.module("demoarmApp");mod.controller("PassFlowCtrl",["$scope","$timeout","$log","myRest",function(a,b,c,d){function e(){return $("#pass-flow-chart")}function f(){var b=moment().subtract(30,"days"),c=_.times(30,function(a){var c=angular.copy(b);c.add(a+1,"days");var d={day:c};return d.passengers=randomIntFromInterval(0,100),d.buses=randomIntFromInterval(10,20),d});if(a.noData=!1,0===c.length){var d=e().highcharts();d&&d.destroy()}else g(c),a.resizePartsPage2()}function g(a){var b=_.map(a,function(a){return a.day.format("DD.MM")}),c=_.map(a,"passengers"),d=_.map(a,"buses");e().highcharts({chart:{zoomType:"xy",backgroundColor:null},credits:{enabled:!1},title:{text:"Пассажиропоток за 30 дней"},exporting:{enabled:!1},xAxis:[{categories:b,crosshair:!0}],yAxis:[{labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[1]}},title:{text:"Кол-во пассажиров",style:{color:Highcharts.getOptions().colors[1]}}},{title:{text:"Кол-во бортов",style:{color:Highcharts.getOptions().colors[0]}},labels:{format:"{value}",style:{color:Highcharts.getOptions().colors[0]}},opposite:!0}],tooltip:{shared:!0},legend:{layout:"vertical",align:"left",x:120,verticalAlign:"top",y:100,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||null},series:[{name:"Пассажиры",type:"column",yAxis:1,data:c,tooltip:{valueSuffix:" чел"}},{name:"Транспорт",type:"spline",data:d,tooltip:{valueSuffix:" шт"}}]})}a.noData=!0,f()}]);var mod=angular.module("demoarmApp");mod.controller("PassFlowHoursCtrl",["$scope","$timeout","$log","myRest",function(a,b,c,d){function e(){return $("#pass-flow-hours-chart")}function f(){var b=_.times(24,function(a){var b={hour:a};return b.passengers=randomIntFromInterval(0,100),b});if(a.noData=!1,0===b.length){var c=e().highcharts();c&&c.destroy()}else g(b),a.resizePartsPage2()}function g(a){var b=_.map(a,"hour"),c=_.map(a,"passengers");e().highcharts({chart:{type:"column",backgroundColor:null},title:{text:"Усреднённый пассажиропоток по часам за 30 дней"},credits:{enabled:!1},exporting:{enabled:!1},xAxis:{categories:b},yAxis:{min:0,allowDecimals:!1,title:{text:"Кол-во пассажиров"}},legend:{enabled:!1},tooltip:{headerFormat:"",pointFormat:'<tr><td style="padding:0">{series.name}: </td><td style="padding:0"><b>{point.y:.0f}</b></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},plotOptions:{column:{pointPadding:.2,borderWidth:0}},series:[{name:"Пассажиров",data:c,color:"#90EE90"}]})}a.noData=!0,f()}]);var mod=angular.module("demoarmApp");mod.controller("PassKmCtrl",["$scope","$timeout","$log","myRest",function(a,b,c,d){function e(){return $("#pass-km-chart")}function f(){var b=_.times(3,function(a){var b={name:"Организация "+(a+1),passKms:[]};return b}),c=moment().subtract(30,"days"),d=_.times(30,function(a){var d=angular.copy(c);return d.add(a+1,"days"),b.forEach(function(a){a.passKms.push({day:d,passKm:randomIntFromInterval(0,100)})}),d}),f={orgs:b,days:d};if(a.noData=!1,0===f.length){var h=e().highcharts();h&&h.destroy()}else g(f),a.resizePartsPage2()}function g(a){var b=_.map(a.days,function(a){return a.format("DD.MM")}),c=[];a.orgs.forEach(function(a){var b={name:a.name};b.data=_.map(a.passKms,"passKm"),c.push(b)}),e().highcharts({chart:{backgroundColor:null},credits:{enabled:!1},title:{text:"Пассажирооборот за 30 дней",x:-20},exporting:{enabled:!1},xAxis:{categories:b},yAxis:{min:0,title:{text:"Пассажиро-километры"},plotLines:[{value:0,width:1,color:"#808080"}]},tooltip:{valueSuffix:""},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},series:c})}a.noData=!0,f()}]);var mod=angular.module("demoarmApp");mod.controller("PiesCtrl",["$scope","$interval","$log","myRest",function(a,b,c,d){function e(a){var b=[];a.forEach(function(a){var c;c=l.hasOwnProperty(a.privilege)?{y:a.transactions,name:l[a.privilege].name,color:l[a.privilege].color}:{y:a.transactions,name:a.privilege},b.push(c)}),$("#privileges-chart").highcharts({chart:{backgroundColor:null,plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,marginTop:0},credits:{enabled:!1},title:{text:null},exporting:{enabled:!1},tooltip:{headerFormat:"",pointFormat:"{point.name}: <b>{point.y:.0f}</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},series:[{type:"pie",name:"privileges",data:b}],legend:{labelFormat:"<b>{name}</b>: {y:.0f}"}})}function f(a){var b=[];a.forEach(function(a){var c={y:a.transactions,name:m[a.cardType].name,color:m[a.cardType].color};b.push(c)}),$("#cards-chart").highcharts({chart:{backgroundColor:null,plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,marginTop:0},credits:{enabled:!1},title:{text:null},exporting:{enabled:!1},tooltip:{headerFormat:"",pointFormat:"{point.name}: <b>{point.y: .0f}</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},series:[{type:"pie",name:"cards",data:b}],legend:{labelFormat:"<b>{name}</b>: {y:.0f}"}})}function g(b){d.getEvents().then(function(c){var c=_.filter(c,function(a){return a.isPayment});if(n!==a.timePeriod||!angular.equals(c,o)){n=angular.copy(a.timePeriod),o=angular.copy(c),c=h(c,b),a.noData=0===c.length;var d=_.groupBy(c,function(a){return a.currency.privilege}),g=[];Object.keys(d).forEach(function(a){var b={};b.privilege=a,b.transactions=d[a].length,g.push(b)});var i=_.groupBy(c,function(a){return a.card.isESEK?"esek":"others"}),j=[];Object.keys(i).forEach(function(a){var b={};b.cardType=a,b.transactions=i[a].length,j.push(b)}),0===c.length?($("#privileges-chart").highcharts()&&$("#privileges-chart").highcharts().destroy(),$("#cards-chart").highcharts()&&$("#cards-chart").highcharts().destroy()):(e(g),f(j),a.resizePartsPage1())}})}function h(a,b){var c=moment();switch(b){case"day":c.startOf("day");break;case"week":c.startOf("week");break;case"month":c.startOf("month");break;case"year":c.startOf("year");break;default:i(format("pie charts: UNEXPECTED time period '{}'",b))}return _.filter(a,function(a){return a.timestamp.isAfter(c)})}function i(a){c.debug(a)}if(a.timePeriod="year",localStorage){var j=localStorage.getItem("timePeriod");j&&(a.timePeriod=j)}a.noData=!0,g(a.timePeriod);var k=b(function(){g(a.timePeriod)},5e3);a.$on("$destroy",function(){b.cancel(k)}),a.onTimePeriodChanged=function(){localStorage&&localStorage.setItem("timePeriod",a.timePeriod),g(a.timePeriod)};var l={unprivileged:{name:"Нет льгот",color:"#000000"}},m={esek:{name:"ЕСЭК",color:"#FF4500"},others:{name:"Бумажный электронный билет",color:"#F08080"}},n=angular.copy(a.timePeriod),o=void 0}]);var mod=angular.module("demoarmApp");mod.controller("TransactionsCtrl",["$scope","$interval","$log","myRest",function(a,b,c,d){function e(a){var b=_.map(a,"name"),c=[],d=[];a.forEach(function(a){c.push(a.successes),d.push(a.errors)}),$("#trans-chart").highcharts({chart:{type:"column",backgroundColor:null},credits:{enabled:!1},title:{text:null},exporting:{enabled:!1},xAxis:{categories:b},yAxis:{min:0,allowDecimals:!1,title:{text:"Кол-во транзакций"},stackLabels:{enabled:!0,style:{fontWeight:"bold",color:Highcharts.theme&&Highcharts.theme.textColor||"white"}}},legend:{align:"right",x:-5,verticalAlign:"top",y:10,floating:!0,backgroundColor:null,borderColor:"#CCC",borderWidth:0,shadow:!1},tooltip:{formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y+"<br/>Всего: "+this.point.stackTotal}},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!0,color:Highcharts.theme&&Highcharts.theme.dataLabelsColor||"white",style:{textShadow:"0 0 3px black"}}}},series:[{name:"Успешные",data:c,color:"#90EE90"},{name:"Неуспешные",data:d,color:"#F08080"}]})}function f(a){return a.timestamp.format("DD.MM")}function g(a){return"ww"+a.timestamp.format("WW")}function h(a){return a.timestamp.format("MMMM YYYY")}function i(a){return a.timestamp.format("YYYY")}function j(a,b){if("day"===b||"week"===b){var c=moment().subtract(1,"years");return _.filter(a,function(a){return a.timestamp.isAfter(c)})}return a}function k(b){d.getEvents().then(function(c){if(p!==a.aggrPeriod||!angular.equals(c,q)){p=angular.copy(a.aggrPeriod),q=angular.copy(c),c=j(c,b),a.noData=0===c.length,_(c).reverse();var d=_.groupBy(c,o[b]),f=[];Object.keys(d).forEach(function(a){var b={};b.name=a;var c=0,e=0;d[a].forEach(function(a){a.isSuccess?c+=1:e+=1}),b.successes=c,b.errors=e,f.push(b)}),f=l(f),0===c.length?$("#trans-chart").highcharts()&&$("#trans-chart").highcharts().destroy():(e(f),a.resizePartsPage1())}})}function l(a){return a.length>30?_.takeRight(a,30):a}if(a.aggrPeriod="day",localStorage){var m=localStorage.getItem("aggrPeriod");m&&(a.aggrPeriod=m)}a.noData=!0,k(a.aggrPeriod);var n=b(function(){k(a.aggrPeriod)},5e3);a.$on("$destroy",function(){b.cancel(n)}),a.onAggrPeriodChanged=function(){localStorage&&localStorage.setItem("aggrPeriod",a.aggrPeriod),k(a.aggrPeriod)},moment.locale("en",{months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"]});var o={day:f,week:g,month:h,year:i},p=angular.copy(a.aggrPeriod),q=void 0}]),angular.module("demoarmApp").controller("MainCtrl",["$scope","$http","socket",function(a,b,c){a.awesomeThings=[],b.get("/api/things").success(function(b){a.awesomeThings=b,c.syncUpdates("thing",a.awesomeThings)}),a.addThing=function(){""!==a.newThing&&(b.post("/api/things",{name:a.newThing}),a.newThing="")},a.deleteThing=function(a){b["delete"]("/api/things/"+a._id)},a.$on("$destroy",function(){c.unsyncUpdates("thing")})}]),angular.module("demoarmApp").config(["$stateProvider",function(a){a.state("main",{url:"/main",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]);var mod=angular.module("demoarmApp");mod.controller("TestCtrl",["$scope","$log","myRest",function(a,b,c){a.userInput={},a.formFields=[{key:"turnover",type:"input",templateOptions:{type:"number",min:0,label:"New turnover value",placeholder:"Enter integer",required:!1}},{key:"balanceAdd",type:"input",templateOptions:{type:"number",min:0,label:"Balance Addition",placeholder:"Enter positive integer",required:!1}}],a.onPostTurnoverBtnClick=function(){c.postTurnover(moment(),a.userInput.turnover),a.userInput.turnover=void 0},a.onReplenishBalanceBtnClick=function(){c.replenishBalance(moment(),a.userInput.balanceAdd),a.userInput.balanceAdd=void 0},a.onPaymentBtnClick=function(){c.makePayment(moment())}}]),angular.module("demoarmApp").config(["$stateProvider",function(a){a.state("test",{url:"/test",templateUrl:"app/test/test.html",controller:"TestCtrl"})}]);var mod=angular.module("alertService",[]);mod.factory("alertService",["$rootScope","$timeout","$interval","$window",function(a,b,c,d){var e={};return a.alerts=[],e.add=function(c,d){var f={type:c,msg:d,close:function(){e.closeAlert(this)}};a.alerts.push(f),b(function(){e.closeAlert(f)},8e3)},e.closeAlert=function(b){e.closeAlertByIndex(a.alerts.indexOf(b))},e.closeAlertByIndex=function(b){a.alerts.splice(b,1)},e.clear=function(){a.alerts=[]},e}]),angular.module("demoarmApp").factory("Auth",["$location","$rootScope","$http","User","$cookieStore","$q",function(a,b,c,d,e,f){var g={};return e.get("token")&&(g=d.get()),{login:function(a,b){var h=b||angular.noop,i=f.defer();return c.post("/auth/local",{email:a.email,password:a.password}).success(function(a){return e.put("token",a.token),g=d.get(),i.resolve(a),h()}).error(function(a){return this.logout(),i.reject(a),h(a)}.bind(this)),i.promise},logout:function(){e.remove("token"),g={}},createUser:function(a,b){var c=b||angular.noop;return d.save(a,function(b){return e.put("token",b.token),g=d.get(),c(a)},function(a){return this.logout(),c(a)}.bind(this)).$promise},changePassword:function(a,b,c){var e=c||angular.noop;return d.changePassword({id:g._id},{oldPassword:a,newPassword:b},function(a){return e(a)},function(a){return e(a)}).$promise},getCurrentUser:function(){return g},isLoggedIn:function(){return g.hasOwnProperty("role")},isLoggedInAsync:function(a){g.hasOwnProperty("$promise")?g.$promise.then(function(){a(!0)})["catch"](function(){a(!1)}):a(g.hasOwnProperty("role")?!0:!1)},isAdmin:function(){return"admin"===g.role},getToken:function(){return e.get("token")}}}]),angular.module("demoarmApp").factory("User",["$resource",function(a){return a("/api/users/:id/:controller",{id:"@_id"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}}})}]),angular.module("demoarmApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("demoarmApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("demoarmApp").controller("NavbarCtrl",["$scope","$location","Auth",function(a,b,c){a.menu=[{title:"Home",link:"/"}],a.isCollapsed=!0,a.isLoggedIn=c.isLoggedIn,a.isAdmin=c.isAdmin,a.getCurrentUser=c.getCurrentUser,a.logout=function(){c.logout(),b.path("/login")},a.isActive=function(a){return a===b.path()}}]);var mod=angular.module("restService",[]);mod.service("myRest",["$http","$q","$log","$rootScope","$interval","$window","alertService",function(a,b,c,d,e,f,g){function h(){return W}function i(){var b=a({method:"get",url:W+"accounts"});return b.then(Q,P)}function j(b){var c=a({method:"get",url:W+format("accounts/{}/bags",b)});return c.then(Q,P)}function k(b){var c=a({method:"get",url:W+format("accounts/{}/transactions",b)});return c.then(Q,P)}function l(b){var c=a({method:"get",url:W+format("accounts/{}/medias",b)});return c.then(Q,P)}function m(){var b=a({method:"get",url:W+"applications"});return b.then(Q,P)}function n(b){var c=a({method:"get",url:W+format("applications/{}/currencies",b)});return c.then(Q,P)}function o(){var a=[],c=b.defer();return i().then(function(b){var d=0;b.forEach(function(e){k(e.id).then(function(e){a=a.concat(e),d===b.length-1&&(a=_.sortBy(a,function(a){return-a.timestamp}),c.resolve(a)),d+=1})})},function(a){c.reject(a)}),c.promise}function p(){var b=a({method:"get",url:X+"vehicles"});return b.then(Q,P)}function q(b){var c=a({method:"get",url:X+format("vehicles/{}/turnovers",b)});return c.then(Q,P)}function r(b){var c=a({method:"get",url:X+format("vehicles/{}/traffics",b)});return c.then(Q,P)}function s(){var a=[],c=b.defer();return m().then(function(b){0===b.length&&c.resolve(a);var d=b[0].id;n(d).then(function(b){b.forEach(function(b){var c={};c.srvID=b.id,c.code=b.symbol,c.name=b.title,c.isPrivileged=null!==b.exemption,c.privilege=null!==b.exemption?b.exemption:"нет льгот",c.isAbonnement=!b.countable,a.push(c)}),c.resolve(a)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}function t(a){var c=[],d=b.defer();return i().then(function(b){var e=0;b.forEach(function(f){var g={};g.id=f.number,g.srvAccountID=f.id,g.state="success",g.isESEK=void 0!==f.userId&&null!==f.userId,g.personID=f.userId,g.bags=[],l(f.id).then(function(h){if(h&&h.length>0){var i=h[0];g.RFID=i.rfid,g.mediaSrvID=i.id;var k=_(i.states).find(function(a){return"activated"===a.state});k?g.activatedAt=moment.unix(k.timestamp):g.activatedAt=null}j(f.id).then(function(f){f.forEach(function(b){var c={};c.srvID=b.id,c.activePeriodStart=moment.unix(b.timeframe.startTimestamp),c.activePeriodFinish=moment.unix(b.timeframe.finishTimestamp),c.currency=_.find(a,function(a){return a.srvID===b.currencyId}),g.bags.push(c)}),c.push(g),e===b.length-1&&d.resolve(c),e+=1})})})},function(a){d.reject(a)}),d.promise}function u(a){var c=b.defer();return s().then(function(b){t(b).then(function(b){var d=w(b,a);c.resolve(d)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}function v(a,b){var c=void 0;return _(a).forEach(function(a){return a.srvID===b?(c=a,!1):void 0}),c}function w(a,b){var c=void 0;return _(a).forEach(function(a){return a.id===b?(c=a,!1):void 0}),c}function x(a,b){var c=void 0;return _(a).forEach(function(a){return _(a.bags).forEach(function(d){return d.srvID===b?(c=a,!1):void 0}),c?!1:void 0}),c}function y(a,b){var c=void 0;return _(a).forEach(function(a){return _(a.bags).forEach(function(a){return a.srvID===b?(c=a,!1):void 0}),c?!1:void 0}),c}function z(a,b){var c=void 0;return _(a.bags).forEach(function(a){return a.srvID===b?(c=a,!1):void 0}),c}function A(){var a=b.defer();return s().then(function(b){t(b).then(function(b){o().then(function(c){var d=[],e=0;c.forEach(function(a){var c={};c.id=e+1,c.srvTransactionID=a.id,c.timestamp=moment.unix(a.timestamp),c.card=x(b,a.bagId),c.bag=y(b,a.bagId),c.operation=a.type;var f=y(b,a.bagId);f&&(c.currency=f.currency),c.value=a.value,c.isSuccess="valid"===a.status,c.isPayment="payment"===a.type,c.isReplenishment="replenishment"===a.type,d.push(c),e+=1}),a.resolve(d)},function(b){a.reject(b)})},function(b){a.reject(b)})},function(b){a.reject(b)}),a.promise}function B(a,b){a.forEach(function(a){a.bags.forEach(function(a){var c=_.filter(b,function(b){return b.bag.srvID===a.srvID}),d=0;c.forEach(function(a){"replenishment"===a.operation?d+=a.value:"payment"===a.operation&&(d-=a.value)}),a.balance=d})})}function C(a,b){a.forEach(function(a){a.bags.forEach(function(a){var c=_.filter(b,function(b){return b.bag.srvID===a.srvID});c&&c.length>0?a.transCount=c.length:a.transCount=0});var c=_.filter(b,function(b){return b.card.srvAccountID===a.srvAccountID;
});if(c&&c.length>0?a.latestTrans=c[0]:a.latestTrans=void 0,a.latestTrans){var d=_.find(a.bags,function(b){return b.srvID===a.latestTrans.bag.srvID});d&&(d.isLatestTrans=!0)}})}function D(){var a=void 0,c=b.defer();return p().then(function(b){if(0===b.length)return void c.resolve(a);var d=b[0];q(d.id).then(function(b){if(0===b.length)return void c.resolve(a);var d=b[b.length-1];c.resolve(d.quantity)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}function E(){var a=[],c=b.defer();return p().then(function(b){0===b.length&&c.resolve(a);var d=b[0];q(d.id).then(function(b){0===b.length&&c.resolve(a),_(b).forEach(function(b){var c={};c.timestamp=moment.unix(b.timestamp),c.value=b.quantity,a.push(c)}),c.resolve(a)},function(a){c.reject(a)})},function(a){c.reject(a)}),c.promise}function F(){var b=a({method:"get",url:Y+"exemptions"});return b.then(Q,P)}function G(){var b=a({method:"get",url:Y+"persons"});return b.then(Q,P)}function H(){var a=[],c=b.defer();return F().then(function(b){b.forEach(function(b){var c={};c.srvID=b.id,c.code=b.ouid,c.name=b.title,a.push(c)}),c.resolve(a)},function(a){c.reject(a)}),c.promise}function I(a){var c=null,d=b.defer();return null===a?(d.reject("person id is null"),d.promise):(H().then(function(b){G().then(function(e){var f=_(e).find(function(b){return b.uuid===a});if(!f)return d.resolve(c),d.promise;c={},c.srvID=f.id,c.id=a,c.name=f.name;var g=[];f.exemptions[0].forEach(function(a){var c=_(b).find(function(b){return b.srvID===a.exemptionid});if(c){var d=angular.copy(c);a.timeframe&&(a.timeframe.startTimestamp&&(d.activePeriodStart=moment.unix(a.timeframe.startTimestamp)),a.timeframe.finishTimestamp&&(d.activePeriodFinish=moment.unix(a.timeframe.finishTimestamp))),g.push(d)}}),c.privileges=g,d.resolve(c)},function(a){d.reject(a)})},function(a){d.reject(a)}),d.promise)}function J(){var a=[],c=b.defer();return p().then(function(b){var d=0;b.forEach(function(e){r(e.id).then(function(f){var g=[];f.forEach(function(a){var b={};b.timestamp=moment.unix(a.timestamp),b.busID=e.terminal_id,a.delta>=0?b.input=a.delta:b.output=-a.delta,g.push(b)}),a=a.concat(g),d===b.length-1&&(a=_.sortBy(a,function(a){return-a.timestamp}),c.resolve(a)),d+=1})})},function(a){c.reject(a)}),c.promise}function K(b,c,d){var e={rfid:b.rfid,number:b.num,timeframe:{startTimestamp:c.unix(),finishTimestamp:d.unix()},user_id:"567834901"},f=a({method:"post",url:Z+"activatecard",data:e});return f.then(Q,P)}function L(b,c,d){var e={rfid:b.rfid,number:b.num,timeframe:{startTimestamp:c.unix(),finishTimestamp:d.unix()},replenishment_data:{}};b.isFixedTripNumTicket?(e.replenishment_data.symbol="PFTT",e.replenishment_data.value=b.tripsLeft):b.isMonthTicketFullPrice?(e.replenishment_data.symbol="PR",e.replenishment_data.value=1):b.isMonthTicketPensioner&&(e.replenishment_data.symbol="PRP",e.replenishment_data.value=1);var f=a({method:"post",url:Z+"activatecard",data:e});return f.then(Q,P)}function M(){var c=b.defer();return a.get("/api/cards").then(function(a){var b=a.data.card;b&&(b.activePeriodStart=moment.unix(b.activePeriodStart),b.activePeriodFinish=moment.unix(b.activePeriodFinish)),c.resolve(b)},function(a){c.reject(a)}),c.promise}function N(){var c=b.defer();return a.get("/api/tickets").then(function(a){var b=a.data.ticket;b&&(b.activePeriodStart=moment.unix(b.activePeriodStart),b.activePeriodFinish=moment.unix(b.activePeriodFinish)),c.resolve(b)},function(a){c.reject(a)}),c.promise}function O(b,c){a.post("/api/tickets/activate",{start:b.unix(),end:c.unix()})}function P(a){return d.urlCausedError=a.config.url,502==a.status||503==a.status||0==a.status?(d.isRestUnavailable=!0,g.add("danger",format("Адрес {} недоступен",d.urlCausedError))):500==a.status?(d.isRestError=!0,g.add("danger",format("При обращении по адресу {} произошла ошибка",d.urlCausedError))):d.isRestUnavailable||d.isRestError?(d.isRestUnavailable=!1,d.isRestError=!1):(d.isRestUnavailable=!1,d.isRestError=!1),b.reject(angular.isObject(a.data)&&a.data.message?{msg:a.data.message,code:a.status}:{msg:"An unknown error occurred.",code:a.status})}function Q(a){return d.isRestUnavailable=!1,d.isRestError=!1,d.urlCausedError=null,a.data}function R(b,c){var d=a({method:"post",url:W+"vehicles/1/turnovers",data:[{timeframe:{startTimestamp:b.unix()-1e3,finishTimestamp:b.unix()},distance:1e3,quantity:c}]});return d.then(Q,P)}function S(b,c){var d=a({method:"post",url:W+"replenishments",data:{symbol:"TRB",rfid:b.RFID,timestamp:moment().unix(),timeframe:{startTimestamp:null,finishTimestamp:null},value:c}});return d.then(Q,P)}function T(b,c,d,e){var f="";if(1===c)f="PRP";else{if(2!==c)throw"Unknown month ticket type: "+c;f="PR"}var g=moment().year(e).month(d-1).date(1).hour(0).minute(0).second(0).millisecond(0),h=moment().year(e).month(d-1).add(1,"months").date(1).hour(0).minute(0).second(0).millisecond(0),i=a({method:"post",url:W+"replenishments",data:{symbol:f,rfid:b.RFID,timestamp:moment().unix(),timeframe:{startTimestamp:g.unix(),finishTimestamp:h.unix()},value:1}});return i.then(Q,P)}function U(b,c){var d=a({method:"post",url:W+"replenishments",data:{symbol:"PFTT",rfid:b.RFID,timestamp:moment().unix(),timeframe:{startTimestamp:moment().unix(),finishTimestamp:moment().add(1,"years").unix()},value:c}});return d.then(Q,P)}function V(b){var c=a({method:"post",url:W+"payment",data:{rfid:"1111-2222-3333-4444",timestamp:b.unix(),serviceId:3,applicationId:3,providerId:4}});return c.then(Q,P)}var W="http://cp.sarov-itc.ru/api/cp/v1/",X="http://cp.sarov-itc.ru/api/pt/v1/",Y="http://10.10.3.120/api/spd/v1/",Z="http://cp.sarov-itc.ru/api/operator/v1/";return a.defaults.headers.common["Content-type"]="application/json",{getAccounts:i,getAccountBags:j,getAccountTransactions:k,getApps:m,getAppCurrencies:n,getAllTransactions:o,getVehicles:p,getVehicleTraffic:r,getCurrencies:s,getCards:t,getCard:u,findCardBySrvID:v,findCardByNum:w,findCardByBagID:x,findCardBag:z,findBag:y,getEvents:A,calcBalance:B,calcTransactions:C,getTurnover:D,getTurnoverHistory:E,getPerson:I,getPassengersInOut:J,postTurnover:R,makePayment:V,getBaseURL:h,activateEsek:K,activateTicket:L,getHwCard:M,getHwTicket:N,activateTicketCardReader:O,esekReplenishPoints:S,esekBuyMonthTicket:T,esekBuyTicket:U}}]),angular.module("demoarmApp").factory("socket",["socketFactory",function(a){var b=io("",{path:"/socket.io-client"}),c=a({ioSocket:b});return{socket:c,syncUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c=_.find(b,{_id:a._id}),e=b.indexOf(c),f="created";c?(b.splice(e,1,a),f="updated"):b.push(a),d(f,a,b)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,a,b)})},unsyncUpdates:function(a){c.removeAllListeners(a+":save"),c.removeAllListeners(a+":remove")}}}]),function(){var a,b,c,d,e,f,g,h={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},j=[].slice;a=function(a){function b(a){this.message=a}return i(b,a),b.prototype.name="ValueError",b}(Error),e="cannot switch from implicit to explicit numbering",c="cannot switch from explicit to implicit numbering",b=function(b){return null==b&&(b={}),function(){var d,g,h,i,k,l;return l=arguments[0],d=2<=arguments.length?j.call(arguments,1):[],h=0,g=i=!1,k="cannot switch from {} to {} numbering",l.replace(/([{}])\1|[{](.*?)(?:!(.+?))?[}]/g,function(j,k,l,m){var n,o,p;if(k)return k;if(l.length){if(i)throw new a(e);g=!0,n=null!=(o=f(d,l))?o:""}else{if(g)throw new a(c);i=!0,n=null!=(p=d[h++])?p:""}return Object.prototype.hasOwnProperty.call(b,m)?b[m](n):n})}},f=function(a,b){var c;for(/^(\d+)([.]|$)/.test(b)||(b="0."+b);c=/(.+?)[.](.+)/.exec(b);)a=g(a,c[1]),b=c[2];return g(a,b)},g=function(a,b){var c;return c=a[b],"function"==typeof c?c.call(a):c},d=b({}),d.create=b,d.extend=function(a,c){var d;d=b(c),a.format=function(){return d.apply(null,[this].concat(j.call(arguments)))}},"undefined"!=typeof module?module.exports=d:"function"==typeof define&&define.amd?define(d):window.format=d}.call(this),angular.module("demoarmApp").run(["$templateCache",function(a){a.put("app/account/login/login.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-12><h1>Login</h1><p>Accounts are reset on server restart from<code>server/config/seed.js</code>. Default account is<code>test@test.com</code>/<code>test</code></p><p>Admin account is<code>admin@admin.com</code>/<code>admin</code></p></div><div class=col-sm-12><form name=form ng-submit=login(form) novalidate class=form><div class=form-group><label>Email</label><input name=email ng-model=user.email class="form-control"></div><div class=form-group><label>Password</label><input type=password name=password ng-model=user.password class="form-control"></div><div class="form-group has-error"><p ng-show="form.email.$error.required &amp;&amp; form.password.$error.required &amp;&amp; submitted" class=help-block>Please enter your email and password.</p><p class=help-block>{{ errors.other }}</p></div><div><button type=submit class="btn btn-inverse btn-lg btn-login">Login</button> <a href=/signup class="btn btn-default btn-lg btn-register">Register</a></div><hr><div><a href="" ng-click=loginOauth(&quot;facebook&quot;) class="btn btn-facebook"><i class="fa fa-facebook"></i> Connect with Facebook</a> <a href="" ng-click=loginOauth(&quot;google&quot;) class="btn btn-google-plus"><i class="fa fa-google-plus"></i> Connect with Google+</a> <a href="" ng-click=loginOauth(&quot;twitter&quot;) class="btn btn-twitter"><i class="fa fa-twitter"></i> Connect with Twitter</a></div></form></div></div><hr></div>'),a.put("app/account/settings/settings.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-12><h1>Change Password</h1></div><div class=col-sm-12><form name=form ng-submit=changePassword(form) novalidate class=form><div class=form-group><label>Current Password</label><input type=password name=password ng-model=user.oldPassword mongoose-error="" class="form-control"><p ng-show=form.password.$error.mongoose class=help-block>{{ errors.other }}</p></div><div class=form-group><label>New Password</label><input type=password name=newPassword ng-model=user.newPassword ng-minlength=3 required class="form-control"><p ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) &amp;&amp; (form.newPassword.$dirty || submitted)" class=help-block>Password must be at least 3 characters.</p></div><p class=help-block>{{ message }}</p><button type=submit class="btn btn-lg btn-primary">Save changes</button></form></div></div></div>'),a.put("app/account/signup/signup.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><div class=row><div class=col-sm-12><h1>Sign up</h1></div><div class=col-sm-12><form name=form ng-submit=register(form) novalidate class=form><div ng-class="{ &quot;has-success&quot;: form.name.$valid &amp;&amp; submitted,        &quot;has-error&quot;: form.name.$invalid &amp;&amp; submitted }" class=form-group><label>Name</label><input name=name ng-model=user.name required class="form-control"><p ng-show="form.name.$error.required &amp;&amp; submitted" class=help-block>A name is required</p></div><div ng-class="{ &quot;has-success&quot;: form.email.$valid &amp;&amp; submitted,        &quot;has-error&quot;: form.email.$invalid &amp;&amp; submitted }" class=form-group><label>Email</label><input type=email name=email ng-model=user.email required mongoose-error="" class="form-control"><p ng-show="form.email.$error.email &amp;&amp; submitted" class=help-block>Doesn\'t look like a valid email.</p><p ng-show="form.email.$error.required &amp;&amp; submitted" class=help-block>What\'s your email address?</p><p ng-show=form.email.$error.mongoose class=help-block>{{ errors.email }}</p></div><div ng-class="{ &quot;has-success&quot;: form.password.$valid &amp;&amp; submitted,        &quot;has-error&quot;: form.password.$invalid &amp;&amp; submitted }" class=form-group><label>Password</label><input type=password name=password ng-model=user.password ng-minlength=3 required mongoose-error="" class="form-control"><p ng-show="(form.password.$error.minlength || form.password.$error.required) &amp;&amp; submitted" class=help-block>Password must be at least 3 characters.</p><p ng-show=form.password.$error.mongoose class=help-block>{{ errors.password }}</p></div><div><button type=submit class="btn btn-inverse btn-lg btn-login">Sign up</button> <a href=/login class="btn btn-default btn-lg btn-register">Login</a></div><hr><div><a href="" ng-click=loginOauth(&quot;facebook&quot;) class="btn btn-facebook"><i class="fa fa-facebook"></i> Connect with Facebook</a> <a href="" ng-click=loginOauth(&quot;google&quot;) class="btn btn-google-plus"><i class="fa fa-google-plus"></i> Connect with Google+</a> <a href="" ng-click=loginOauth(&quot;twitter&quot;) class="btn btn-twitter"><i class="fa fa-twitter"></i> Connect with Twitter</a></div></form></div></div><hr></div>'),a.put("app/admin/admin.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><div class=container><p>The delete user and user index api routes are restricted to users with the \'admin\' role.</p><ul class=list-group><li ng-repeat="user in users" class=list-group-item><strong>{{user.name}}</strong><br><span class=text-muted>{{user.email}}</span><a ng-click=delete(user) class=trash><span class="glyphicon glyphicon-trash pull-right"></span></a></li></ul></div>'),a.put("app/dashboard/cards.html",'<!--h2(style="text-align: center") Процессинг карт--><div id=table-wrapper style="height: 290px; overflow-y: auto"><table style="background: white; margin-bottom: 0px" class="table table-bordered table-hover table-condensed"><tbody ng-repeat="card in cards"><tr class=no-border><th style="color: blue; font-size: 110%" class="w25 no-border">Карта {{ card.id }}</th><th class="w25 no-border"><small>RFID {{ card.RFID }}</small></th><th colspan=2 class="w25 no-border text-right"><small>активирована {{ card.activatedAt.toDate() | date:\'yyyy-MM-dd HH:mm:ss\' }}</small></th></tr><tr><th style="padding-left: 30px" class=w25>Кошелек</th><th class="w25 text-right">Баланс</th><th class="w25 text-right">Начало действия</th><th class="w25 text-right">Конец действия</th></tr><tr ng-repeat="bag in card.bags"><td style="padding-left: 30px" class=w25>{{ bag.currency.name }}</td><td ng-class="{ animated: bag.wasUpdated, infinite: bag.wasUpdated, flash: bag.wasUpdated, \'table-cell-changed\': bag.wasUpdated, \'bg-success\': bag.wasUpdated }" class="w25 text-right">{{ bag.balance }}</td><td class="w25 text-right">{{ bag.activePeriodStart.toDate() | date:\'yyyy-MM-dd HH:mm:ss\' }}</td><td class="w25 text-right">{{ bag.activePeriodFinish.toDate() | date:\'yyyy-MM-dd HH:mm:ss\' }}</td></tr></tbody></table></div>'),a.put("app/dashboard/dashboard.html",'<div id=dashboard class=container-fluid><div class=row><div class="row-same-height row-full-height"><div class="col-xs-6 col-xs-height col-full-height"><div class=item><div ui-view=cards style="padding-left: 5px; padding-right: 5px" class=content></div></div></div><div class="col-xs-6 col-xs-height col-full-height"><div class=item><div ui-view=turnover class=content></div></div></div></div></div><div class=row><div class="row-same-height row-full-height"><div class="col-xs-6 col-xs-height col-full-height"><div class=item><div ui-view=events style="padding-left: 5px; padding-right: 5px" class=content></div></div></div><!--.col-xs-3.col-xs-height.col-full-height--><!--  .item--><!--    .content(ui-view="transactions", style="padding-left: 5px; padding-right: 5px;")--><div class="col-xs-6 col-xs-height col-full-height"><div class=item><div ui-view=flow class=content></div></div></div></div></div></div><!-- Show server unavailable message, if necessary--><div id=msg-server-unavailable ng-show=isRestUnavailable><alert type=danger class=text-center>Сервер <b>http://cp-prod.corp.sarov-itc.ru</b> недоступен</alert></div><footer class=text-center><p class=copyright>Copyright &copy; 2015 &mdash;&nbsp;<a href="http://sarov-itc.ru/">ИТЦ Система-Саров</a></p></footer><!--*********************************************************--><!-- Flex experiment--><!--#dashboard.vw100.vh100--><!--  .flex-container.h50--><!--    .flex-item.w50(ui-view="cards")--><!--    .flex-item.w50(ui-view="turnover")--><!--  .flex-container.h50--><!--    .flex-item.w50(ui-view="events")--><!--    .flex-item.w50(ui-view="flow")--><!--*********************************************************--><!--=============================================================================--><!-- Experiments with the layout--><!--.vw100.vh100--><!--  .w50.h100.left(style="background: grey")--><!--    .w100.h50(ui-view="cards", style="background: red")--><!--    .w50.h50.left(ui-view="events", style="background: green")--><!--    .w50.h50.left(ui-view="transactions", style="background: blue")--><!--  .w50.h100.left(style="background: lightgrey")--><!--    .w100.h50(ui-view="turnover", style="background: lightgreen")--><!--    .w100.h50(ui-view="flow", style="background: lightblue")--><!--=============================================================================-->'),a.put("app/dashboard/events.html",'<!--h2(style="text-align: center") События--><div id=table-header-wrapper><table style="margin-bottom: 0px" class=table><thead><tr class=info><th style="width: 5%"></th><th class=w20>Время</th><th class=w20>Карта</th><th class=w20>Операция</th><th class=w20>Валюта</th><th style="text-align: right; width: 15%">Сумма</th></tr></thead></table></div><div id=table-wrapper style="height: 290px; overflow-y: auto"><table style="background: white; margin-bottom: 0px" class="table table-bordered table-hover table-condensed"><tbody ng-repeat="event in events"><tr ng-class="{ \'new-event\': event.wasUpdated }"><td style="width: 5%"><span style="color: green" ng-if=event.isSuccess class="fa fa-check-circle"></span><span style="color: red" ng-if=!event.isSuccess class="fa fa-minus-circle"></span></td><td class=w20>{{ event.timestamp.toDate() | date:\'yyyy-MM-dd HH:mm:ss\' }}</td><td class=w20>{{ event.card.id }}</td><td class=w20>{{ event.operation | eventOperationFilter }}</td><td class=w20>{{ event.currency.name | lowercase }}</td><td style="text-align: right; width: 15%">{{ event.value }}</td></tr></tbody></table></div><!--pre {{ transactions }}-->'),a.put("app/dashboard/flow.html",'<!--h2(style="text-align: center") Пассажиропоток--><div id=flow-chart></div>'),a.put("app/dashboard/transactions.html",'<h2>Транзакции</h2><ul><li ng-repeat="transaction in transactions">{{ transaction }}</li></ul>'),a.put("app/dashboard/turnover.html",'<!--h2(style="text-align: center") Пассажирооборот--><div id=chart></div>'),a.put("app/dashboard2/buses.html",'<div id=buses-page-title class="large-text text-center">Текущие данные по бортам</div><table id=bus-infos-table ng-hide=noData fixed-header=fixed-header table-height="{{ busInfoTableH }}" class="table table-bordered table-hover table-condensed"><thead id=bus-infos-table-hdr><tr class=info><th class=text-right>ID борта</th><th class=text-right>Время</th><!--th.text-right Координаты--><th class=text-right>Вошло, чел.</th><th class=text-right>Вышло, чел.</th><!--th.text-right В салоне, чел.--></tr></thead><tbody id=bus-infos-table-body><tr ng-repeat="busInfo in data"><td class=text-right>{{ busInfo.busID }}</td><td class=text-right>{{ busInfo.timestamp.toDate() | date:\'yyyy-MM-dd HH:mm:ss\' }}</td><!--td.text-right {{ busInfo | busCoordinateFilter }}--><td class="text-right color-green">{{ busInfo.input | busInputFilter }}</td><td class="text-right color-red">{{ busInfo.output | busOutputFilter }}</td><!--td.text-right {{ busInfo.inside }}--></tr></tbody></table><div id=buses-no-data-msg ng-show=noData class=no-data-msg>НЕТ ДАННЫХ</div>'),a.put("app/dashboard2/cardproc.html",'<div id=cardproc-wrapper><!--.section-title Процессинг карт--><div id=card-panels-container ng-show="cards.length &gt; 0"><div ng-repeat="card in cards" ng-class="{ animated: card.justChanged &amp;&amp; cards.length &gt; 1, fadeInUp: card.justChanged &amp;&amp; cards.length &gt; 1 }" class=card-panel-container><div ng-class=getCardPanelClass(card.state) class=panel><div class="card-panel-heading panel-heading"><div class=card-num>{{ card | cardTitleFilter }}</div><div class=card-rfid><small>RFID {{ card.RFID }}</small></div><div class=card-activation-time><small>активирована {{ card.activatedAt.toDate() | date:\'yyyy-MM-dd HH:mm:ss\' }}</small></div></div><div class="panel-body card-proc-panel-body"><table style="background: white; margin-bottom: 0px" ng-show="card.bags.length &gt; 0" class="table table-bordered table-hover table-condensed no-border"><thead><tr><th style="padding-left: 30px" class="w25 no-border">Способ оплаты</th><th class="w25 no-border text-right">Баланс</th><th class="w25 no-border text-right">Период действия</th><th class="w25 no-border text-right">Кол-во операций</th></tr></thead><tbody><tr ng-repeat="bag in card.bags" ng-class="{ \'latest-bag\': bag.isLatestTrans }"><td style="padding-left: 30px" class="w25 no-border">{{ bag.currency.name }}</td><td ng-hide=bag.currency.isAbonnement class="w25 no-border text-right"><span ng-class="{ animated: bag.wasUpdated, infinite: bag.wasUpdated, flash: bag.wasUpdated, \'table-cell-changed\': bag.wasUpdated, \'bg-success\': bag.wasUpdated }" style="padding: 5px 10px">{{ bag.balance }}</span></td><td ng-show=bag.currency.isAbonnement class="w25 no-border text-right">---</td><td class="w25 no-border text-right">{{ bag | bagActivePeriodFilter }}</td><td class="w25 no-border text-right">{{ bag.transCount }}</td></tr></tbody></table><p ng-show="card.bags.length === 0">Недоступен ни один из способов оплаты</p></div><div ng-show=card.latestTrans class="card-panel-footer panel-footer"><div class=trans-status><span style="color: green" ng-if=card.latestTrans.isSuccess class="fa fa-check-circle"></span><span style="color: red" ng-if=!card.latestTrans.isSuccess class="fa fa-minus-circle"></span></div><div class=trans-dt>{{ card.latestTrans.timestamp.toDate() | date:\'yyyy-MM-dd HH:mm:ss\' }}</div><div class=trans-curr>{{ card.latestTrans.currency.name }}</div><div class=trans-oper>{{ card.latestTrans.operation | eventOperationFilter }}</div><div class=trans-val>{{ card.latestTrans.value }}</div></div></div></div></div><div id=no-cards-msg ng-show="cards.length === 0"><div class="large-text text-center">НЕТ ДАННЫХ</div></div></div>'),a.put("app/dashboard2/dashboard2.html",'<div id=wrapper class=w100><div id=page1 class=vh100><div id=header><div id=header-logo><!--a(href="http://sarov-itc.ru/" target="_blank")--><!--  img(width="238" height="32" alt="Лого" src="assets/images/cc4d91a0.logo.png")--></div><div id=header-text>Система обработки электронных карт</div><div id=header-right-part class="text-right dashboard-margin-right"><button ng-click=gotoPage2() class="btn btn-success">Страница 2</button></div></div><div id=page1-content class=Grid><div id=left-part ui-view=cardproc class=Grid-cell></div><div id=right-part class="Grid-cell dashboard-margin-right"><div id=my-right-up ui-view=pies class=right-up></div><div id=my-right-down ui-view=transactions class=right-down></div></div></div></div><div id=page2 class=vh100><div id=page2-navi class="text-right dashboard-margin-right"><button ng-click=gotoPage1() class="btn btn-success">Страница 1</button></div><div id=page2-line1 class=Grid><div class=Grid-cell><div id=pass-flow ui-view=passFlow></div></div><div class="Grid-cell dashboard-margin-right"><div id=pass-flow-hours ui-view=passFlowHours></div></div></div><div id=page2-line2 class=Grid><div id=pass-turnover class=Grid-cell><div id=pass-km ui-view=passKm></div></div><div id=vehicle-pass class="Grid-cell dashboard-margin-right"><div id=buses ui-view=buses></div></div></div><footer id=footer class=text-center>Copyright &copy; 2015 &mdash;&nbsp;<a href="http://sarov-itc.ru/" target=_blank>ИТЦ Система-Саров</a></footer></div><!-- Show server unavailable message, if necessary--><!--.errmsg(ng-show=\'isRestUnavailable\')--><!--  alert.text-center(type=\'danger\') Сервер <b>{{ baseURL }}</b> недоступен--><!--.errmsg(ng-show=\'isRestError\')--><!--  alert.text-center(type=\'danger\') На сервере <b>{{ baseURL }}</b> произошла ошибка--><div id=alert-section ng-show="alerts.length &gt; 0" class=msg-in-center><alert ng-repeat="alert in alerts" type={{alert.type}} close=alert.close() class=alert-fading-out><span ng-bind=alert.msg></span></alert></div></div>'),a.put("app/dashboard2/passFlow.html","<div id=pass-flow-chart ng-hide=noData></div><div id=pass-flow-no-data-msg ng-show=noData class=no-data-msg>НЕТ ДАННЫХ</div>"),a.put("app/dashboard2/passFlowHours.html","<div id=pass-flow-hours-chart ng-hide=noData></div><div id=pass-flow-hours-no-data-msg ng-show=noData class=no-data-msg>НЕТ ДАННЫХ</div>"),a.put("app/dashboard2/passKm.html","<div id=pass-km-chart ng-hide=noData></div><div id=pass-km-no-data-msg ng-show=noData class=no-data-msg>НЕТ ДАННЫХ</div>"),a.put("app/dashboard2/pies.html",'<div id=pies-header><!--#pies-title Распределение по видам льгот и типам карт--><div id=pies-period-buttons><!--pre {{ timePeriod || \'undefined\'}}--><div class=btn-group><label ng-model=timePeriod btn-radio="\'day\'" ng-change=onTimePeriodChanged() class="btn btn-primary">День</label><!--label.btn.btn-primary(ng-model=\'timePeriod\', btn-radio="\'week\'", ng-change="onTimePeriodChanged()") Неделя--><label ng-model=timePeriod btn-radio="\'month\'" ng-change=onTimePeriodChanged() class="btn btn-primary">Месяц</label><label ng-model=timePeriod btn-radio="\'year\'" ng-change=onTimePeriodChanged() class="btn btn-primary">Год</label></div></div></div><div id=pies-no-data-msg ng-show=noData class=no-data-msg>НЕТ ДАННЫХ</div><div id=pies-wrapper ng-hide=noData><div id=privileges-chart></div><div id=cards-chart></div></div>'),a.put("app/dashboard2/transactions.html",'<div id=trans-header><!--#trans-title Количество операций--><div id=trans-aggr-period-buttons><div class=btn-group><label ng-model=aggrPeriod btn-radio="\'day\'" ng-change=onAggrPeriodChanged() class="btn btn-primary">День</label><!--label.btn.btn-primary(ng-model=\'aggrPeriod\', btn-radio="\'week\'", ng-change="onAggrPeriodChanged()") Неделя--><label ng-model=aggrPeriod btn-radio="\'month\'" ng-change=onAggrPeriodChanged() class="btn btn-primary">Месяц</label><label ng-model=aggrPeriod btn-radio="\'year\'" ng-change=onAggrPeriodChanged() class="btn btn-primary">Год</label></div></div></div><div id=trans-chart ng-hide=noData></div><div id=trans-no-data-msg ng-show=noData class=no-data-msg>НЕТ ДАННЫХ</div>'),a.put("app/main/main.html",'<div ng-include=&quot;components/navbar/navbar.html&quot;></div><header id=banner class=hero-unit><div class=container><h1>\'Allo, \'Allo!</h1><p class=lead>Kick-start your next web app with Angular Fullstack</p><img src=assets/images/66adba84.yeoman.png alt="I\'m Yeoman"></div></header><div class=container><div class=row><div class=col-lg-12><h1 class=page-header>Features:</h1><ul ng-repeat="thing in awesomeThings" class="nav nav-tabs nav-stacked col-md-4 col-lg-4 col-sm-6"><li><a href=# tooltip={{thing.info}}>{{thing.name}}<button type=button ng-click=deleteThing(thing) class=close>×</button></a></li></ul></div></div><form class=thing-form><label>Syncs in realtime across clients</label><p class=input-group><input placeholder="Add a new thing here." ng-model=newThing class="form-control"><span class=input-group-btn><button type=submit ng-click=addThing() class="btn btn-primary">Add New</button></span></p></form></div><footer class=footer><div class=container><p>Angular Fullstack v2.0.13 | <a href=https://twitter.com/tyhenkel>@tyhenkel</a> | <a href="https://github.com/DaftMonk/generator-angular-fullstack/issues?state=open">Issues</a></p></div></footer>'),a.put("app/test/test.html",'<div class="container col-md-4 col-md-offset-4"><form novalidate><h1>Simulate actions</h1><formly-form model=userInput fields=formFields form=myForm><button type=button ng-click=onPostTurnoverBtnClick() ng-disabled=!userInput.turnover class="btn btn-primary">Post Turnover</button><button type=button ng-click=onReplenishBalanceBtnClick() style="margin-left: 10px" ng-disabled=!userInput.balanceAdd class="btn btn-primary">Replenish Balance</button><button type=button ng-click=onPaymentBtnClick() style="margin-left: 10px" class="btn btn-primary">Pay!</button></formly-form></form></div>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div ng-controller=NavbarCtrl class="navbar navbar-default navbar-static-top"><div class=container><div class=navbar-header><button type=button ng-click="isCollapsed = !isCollapsed" class=navbar-toggle><span class=sr-only>Toggle navigation</span><span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button><a href="/" class=navbar-brand>demoarm</a></div><div id=navbar-main collapse=isCollapsed class="navbar-collapse collapse"><ul class="nav navbar-nav"><li ng-repeat="item in menu" ng-class="{active: isActive(item.link)}"><a ng-href={{item.link}}>{{item.title}}</a></li><li ng-show=isAdmin() ng-class="{active: isActive(&quot;/admin&quot;)}"><a href=/admin>Admin</a></li></ul><ul class="nav navbar-nav navbar-right"><li ng-hide=isLoggedIn() ng-class="{active: isActive(&quot;/signup&quot;)}"><a href=/signup>Sign up</a></li><li ng-hide=isLoggedIn() ng-class="{active: isActive(&quot;/login&quot;)}"><a href=/login>Login</a></li><li ng-show=isLoggedIn()><p class=navbar-text>Hello {{ getCurrentUser().name }}</p></li><li ng-show=isLoggedIn() ng-class="{active: isActive(&quot;/settings&quot;)}"><a href=/settings><span class="glyphicon glyphicon-cog"></span></a></li><li ng-show=isLoggedIn() ng-class="{active: isActive(&quot;/logout&quot;)}"><a href="" ng-click=logout()>Logout</a></li></ul></div></div></div>')}]);